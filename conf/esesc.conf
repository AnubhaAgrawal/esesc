##########################################################
# Global configuration varaibles can be used by multiple
# sections
#
# - These variables are used for setting configuration
#   that are frequently overidden by environment variables
##########################################################

# Select simulated core type. Defined in shared.conf
coreType   = 'tradCORE'
#coreType   = 'scooreCORE'
SMcoreType = 'gpuCORE'

# Target benchmark
benchName  = "./exe/crafty.armel"
#benchName = "launcher -- stdin crafty.in -- crafty"
#benchName = "launcher -- blackscholes 2 in_64k.txt out"

# Emulator and simulator mode
#  - Also selects the number of core and whether
#    it is a homogenous or heterogeous CPU
cpuemul[0]  = 'QEMUSectionCPU' 
cpusimu[0]  = "$(coreType)"

# Sampling mode
samplerSel = "SMARTSMode"
#samplerSel = "SkipSim"
#samplerSel = "TimeBasedSampling"

# Suffix for report file group name:
#  e.g. esesc_microdemo
reportFile = 'microdemo'

# Thermal configuraiton settings
# TODO: Check if these can be moved to therm.conf
# TODO: Make thermFF a bool (if possible)
thermTT      = 468.15
thermFF      = 1 #used in therm.conf
enablePower  = false 

# Global Power settings
technology = 'ThisSOCTech'
pwrmodel   = 'McPatPwrCounters'
thermal    = 'SescTherm'
floorplan  = 'layoutDescr'

##########################################################
# Global variables for GPU simulation
# (not covered in MICRO tutorial)
##########################################################
SP_PER_SM  = 0
MAXTHREADS = 0
infofile   = "foo.info"

gpusampler = "GPUSpacialMode"
#cpuemul[0]   = 'QEMUSectionCPU' 
#cpuemul[1:4] = 'QEMUSectionGPU' 
#cpuemul[5]   = 'QEMUSectionCPU' 
#cpuemul[6:9] = 'QEMUSectionGPU' 
#cpusimu[0]   = "$(coreType)"
#cpusimu[1:4] = "$(SMcoreType)"
#cpusimu[5]   = "$(coreType)"
#cpusimu[6:9] = "$(SMcoreType)"
#SP_PER_SM = 32
##########################################################


##########################################################
# **************** END GLOBALS ***************************
# WARNING: Any variables added from this point on will be
# part of a section and cannot be accessed from the global
# scope.
##########################################################

##########################################################
# Include files
##########################################################
<gpu.conf> # GPU simulation include file
<shared.conf> # simulated CPU settings
<therm.conf>  # thermal configuration


##########################################################
# Power settings 
##########################################################
[ThisSOCTech]
frequency      = 3000e6 # frequency Hz
tech  = 32
devType = 0  # 0: HP, 1: LSTP, 2: LOP
machineBits = 64
phyAddrBits = 54
virAddrBits = 64
scaleDynPow = 0.6
scaleLkgPow = 1.2

##########################################################
#  EMULATOR   CONFIGURATION   
##########################################################

[QEMUSectionCPU]
type      = "qemu"
dorun     = true
sampler   = "$(samplerSel)"
syscall   = "NoSyscall"
params[0] = "$(benchName)"

[NoSyscall]
enable   = false
generate = false
runtime  = false

##########################################################
# Sampler configuration         
##########################################################

[SkipSim]
type               = "SkipSim"
nInstSkip          = 1
nInstSkipThreads   = 1
nInstMax           = 1.4e7

[SMARTSMode]
type              = "SMARTS"
PowPredictionHist = 11
doPowPrediction = 0
nInstSkip         = 1e9
nInstSkipThreads  = 1e9 
nInstMax          = 15e8
nInstRabbit       = 251e4
nInstWarmup       = 240e4
nInstDetail       = 2e4
nInstTiming       = 7e4

[TimeBasedSampling]
type              = "Periodic"
nInstSkip         = 1e9
nInstSkipThreads  = 1e9
maxnsTicks        = 1e9
nSampleMax        = 2e1
nInstMax          = 2e9
nInstRabbit       = 0
nInstWarmup       = 493e4
nInstDetail       = 2e4
nInstTiming       = 5e4
PowPredictionHist = 3
doPowPrediction   = 1
TPR               = 1e0

# Example SimPoints:
# These are from crafty for SPARC and 
# are not correct for curret ARM binary
#[SPointMode186crafty]
#type             = SPoint
#spointSize       = 1e8
#spoint[0]        = 67e8
#spweight[0]      = 0.152
#spoint[1]        = 436e8
#spweight[1]      = 0.294
#spoint[2]        = 466e8
#spweight[2]      = 0.028
#spoint[3]        = 643e8
#spweight[3]      = 0.189
#spoint[4]        = 779e8
#spweight[4]      = 0.226
#spoint[5]        = 838e8
#spweight[5]      = 0.111
#doPowPrediction  = 0
#nInstSkip        = 1e1
#nInstSkipThreads = 1e1

##########################################################
# GPU simulation settings
# (not covered in MICRO tutorial)
##########################################################

[QEMUSectionGPU]
type          = "gpu"
dorun         = true
sampler       = "$(gpusampler)"
syscall       = "NoSyscall"
params[0]     = "$(infofile)"
pes_per_sm    = $(SP_PER_SM)  #Number of sps in a sm 
warpsize      = $(SP_PER_SM)  #Same as pes_per_sm
halfwarpsize  = $(SP_PER_SM)  #Same as warpsize
max_warps_sm  = 24            #Maximum concurrent warps on SM, constant for an arch.
max_blocks_sm = 8             #Maximum concurrent blocks on a SM, constant for an arch.
max_regs_sm   = 32*1024       #Constant for an arch.
max_shmem_sm  = 48*1024       #Constant for an arch.
thread_granularity  = 64      #Constant for an arch.
shmem_granularity   = 128     #Constant for an arch.
unifiedCPUGPUmem    = false   #true -> no CUDAmemcpys, false ->simulate CUDAmemcpys

[GPUSpacialMode]
type        = "GPUSpacial"
nMaxThreads = $(MAXTHREADS) 
nInstSkip   = 0
nInstMax    = 1e14

